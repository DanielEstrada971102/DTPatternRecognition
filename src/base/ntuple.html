

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NTuple &mdash; DTPatternRecognition 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/general_styles.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="EventList" href="event_list.html" />
    <link rel="prev" title="Event" href="event.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            DTPatternRecognition
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../analysis/main.html">analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="main.html">base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="event.html">Event</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">NTuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_list.html">EventList</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../particles/main.html">particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/main.html">utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DTPatternRecognition</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="main.html">base</a></li>
      <li class="breadcrumb-item active">NTuple</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/src/base/ntuple.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ntuple">
<h1>NTuple<a class="headerlink" href="#ntuple" title="Link to this heading">ÔÉÅ</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class serves as a simple gateway to access information from single or multiple <cite>.root</cite>
Ntuples (flat) located in the specified input path. It represents an interface to build <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances
directly from the TTree event entries. This class is capable of preprocessing, filtering and building <code class="docutils literal notranslate"><span class="pre">Event</span></code>
instances according to the <strong>preprocessors</strong>, and <strong>selectors</strong> passed.</p>
<p>A preprocessor refers to a function that takes an <code class="docutils literal notranslate"><span class="pre">Event</span></code> instance as input and returns the same
<code class="docutils literal notranslate"><span class="pre">Event</span></code> instance after applying any necessary modifications or additions. A selector refers to a
function that returns a boolean based on the information of an <code class="docutils literal notranslate"><span class="pre">Event</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class is designed to be generic and handle many types of NTuple since <code class="docutils literal notranslate"><span class="pre">Event</span></code> creation can be
controlled through <strong>particle classes</strong> definitions and <strong>configuration files</strong>. The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class only loads
the ROOT TTrees in a TChain (accessible through the attribute <code class="docutils literal notranslate"><span class="pre">tree</span></code>), and generates <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances
on the fly (accessible through the attribute <code class="docutils literal notranslate"><span class="pre">events</span></code>), applying before returning, the <code class="docutils literal notranslate"><span class="pre">NTuple._event_preprocessor</span></code>
method to perform any necessary processing and selecting steps.</p>
<p>This was implemented in that way to allow creating selectors based on properties that by default
do not come directly from the input NTuples, but can be computed with extra preprocess functions
steps before applying the selection.</p>
<p>The following example shows how to use the <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class to read DT Ntuples and access to events.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.utils.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">RUN_CONFIG</span>

<span class="c1"># First, you need to update the configuration file path since Events creation</span>
<span class="c1"># requires it, If not, it will work with the default one dtpr/utils/yamls/run_template.yaml.</span>
<span class="n">RUN_CONFIG</span><span class="o">.</span><span class="n">change_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;path/to/config.yaml&quot;</span><span class="p">)</span>

<span class="c1"># path to the DT Ntuple, it could be a folder with several files</span>
<span class="n">input_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span>
        <span class="s2">&quot;../../test/ntuples/DTDPGNtuple_12_4_2_Phase2Concentrator_thr6_Simulation_99.root&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="n">ntuple</span> <span class="o">=</span> <span class="n">NTuple</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">tree_name</span><span class="o">=</span><span class="s2">&quot;/dtNtupleProducer/DTTREE&quot;</span><span class="p">)</span>
<span class="c1"># you can access events by index or slice such as a list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># slicing return a generator</span>

<span class="c1"># or loop over the events</span>
<span class="k">for</span> <span class="n">iev</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
    <span class="k">break</span>

<span class="c1"># or simply use the TTree</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ntuple</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">event_orbitNumber</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+ Opening input file /root/DTPatternRecognition/test/ntuples/DTDPGNtuple_12_4_2_Phase2Concentrator_thr6_Simulation_99.root
&gt;&gt; ------ Event 39963 info ------
+ Index: 10
+ Digis
    * Number of digis: 105
+ Segments
    * Number of segments: 14
+ Tps
    * Number of tps: 20
+ Genmuons
    * Number of genmuons: 2
    * GenMuon 1 info --&gt;
    --&gt; Pt: 28.614336013793945, Eta: 4.255909442901611, Phi: -1.395720362663269, Charge: 1, Matched_segments_stations: [], Showered: False
    * GenMuon 0 info --&gt;
    --&gt; Pt: 23.001548767089844, Eta: 2.4365286827087402, Phi: 1.7807667255401611, Charge: -1, Matched_segments_stations: [], Showered: False
+ Emushowers
    * Number of emushowers: 1
+ Simhits
    * Number of simhits: 0
&lt;generator object EventList.__getitem__.&lt;locals&gt;.&lt;genexpr&gt; at 0x7f00c424b440&gt;
&gt;&gt; ------ Event 39956 info ------
+ Index: 0
+ Digis
    * Number of digis: 81
+ Segments
    * Number of segments: 8
+ Tps
    * Number of tps: 21
+ Genmuons
    * Number of genmuons: 2
    * GenMuon 0 info --&gt;
    --&gt; Pt: 258.0812683105469, Eta: -1.9664770364761353, Phi: 0.5708979964256287, Charge: -1, Matched_segments_stations: [], Showered: False
    * GenMuon 1 info --&gt;
    --&gt; Pt: 190.72511291503906, Eta: -0.2504693865776062, Phi: -2.558511257171631, Charge: 1, Matched_segments_stations: [], Showered: False
+ Emushowers
    * Number of emushowers: 0
+ Simhits
    * Number of simhits: 50
Event orbit number: -1
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple.events</span></code> attribute is not a simple list, but an instance of the <a class="reference internal" href="event_list.html"><span class="doc">EventList</span></a> class.
This design prevents loading all events into memory simultaneously. Instead, it allows iteration and access by index and slice,
while internally iterating over the root tree entries to create the required event on the fly.</p>
</div>
<p>Previous example does not use any preprocessor or selector, but you can define them and pass as
arguments to the <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class. But, since Events creation requires from a config file, an already
defined function (<code class="docutils literal notranslate"><span class="pre">init_ntuple_from_config</span></code>) that instantiates the NTuple class and passes
preprocessors and selectors taken from the <code class="docutils literal notranslate"><span class="pre">YAML</span></code> configuration file is available in <code class="docutils literal notranslate"><span class="pre">dtpr.utils.functions</span></code>.
This only requires specifying the following in the configuration file under <code class="docutils literal notranslate"><span class="pre">ntuple_preprocessors</span></code>
and <code class="docutils literal notranslate"><span class="pre">ntuple_selectors</span></code> sections:</p>
<p class="rubric">config.yaml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ntuple_selectors</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;dtpr.utils.filters.base_filters.baseline&quot;</span>
<span class="c1"># Add other as needed ....</span>

<span class="nt">ntuple_preprocessors</span><span class="p">:</span>
<span class="w">    </span><span class="nt">genmuon_matcher</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dtpr.utils.genmuon_functions.analyze_genmuon_matches&quot;</span>
<span class="w">    </span><span class="nt">genmuon_showerer</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dtpr.utils.genmuon_functions.analyze_genmuon_showers&quot;</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span><span class="w"> </span><span class="c1"># if the function requires arguments...</span>
<span class="w">            </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>and then, insted of creating the NTuple instance directly, you can use the function after updating the configuration file path.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.utils.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_ntuple_from_config</span>

<span class="n">RUN_CONFIG</span><span class="o">.</span><span class="n">change_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;path/to/config.yaml&quot;</span><span class="p">)</span>
<span class="c1"># ntuple = NTuple(input_folder, tree_name=&quot;/dtNtupleProducer/DTTREE&quot;)</span>
<span class="n">ntuple</span> <span class="o">=</span> <span class="n">init_ntuple_from_config</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">tree_name</span><span class="o">=</span><span class="s2">&quot;/dtNtupleProducer/DTTREE&quot;</span><span class="p">)</span>

<span class="c1"># ...</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="event.html" class="btn btn-neutral float-left" title="Event" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="event_list.html" class="btn btn-neutral float-right" title="EventList" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Daniel Estrada.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>