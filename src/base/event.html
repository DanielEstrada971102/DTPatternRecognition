

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event &mdash; DTPatternRecognition 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NTuple" href="ntuple.html" />
    <link rel="prev" title="Particle" href="particle.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            DTPatternRecognition
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../analysis/main.html">analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="main.html">base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="particle.html">Particle</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntuple.html">NTuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_list.html">EventList</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../particles/main.html">particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/main.html">utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DTPatternRecognition</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="main.html">base</a></li>
      <li class="breadcrumb-item active">Event</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/DanielEstrada971102/DTPatternRecognition" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="event">
<h1>Event<a class="headerlink" href="#event" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Event</span></code> class is designed to represent an event entry from a ROOT TTree, facilitating access
to information by abstracting info into instances of <a class="reference internal" href="particle.html"><span class="doc">Particle</span></a> class.
Each instance of the <code class="docutils literal notranslate"><span class="pre">Event</span></code> class allows to comfortably access those objects such as offline segments, generation-level muons,
simulation digis, showers, and more.</p>
<p>Thanks to how <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class was designed, the <code class="docutils literal notranslate"><span class="pre">Event</span></code> class can dynamically build particles based
on specifications from a <strong>configuration file</strong>. This file should contain information about the types
of particles and how to build them, allowing for flexible and customizable event processing.</p>
<p>To illustrate the dynamic particle-building feature, suppose we want to extract digi information from
the TTree event’s entries when an event is instantiated. This requires specifying the following in
a <cite>YAML</cite> configuration file under the <code class="docutils literal notranslate"><span class="pre">particle_types</span></code> map:</p>
<p class="rubric">run_config.yaml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">particle_types</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">    </span><span class="nt">digis</span><span class="p">:</span>
<span class="w">        </span><span class="nt">amount</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_nDigis&#39;</span>
<span class="w">        </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">            </span><span class="nt">wh</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_wheel&#39;</span>
<span class="w">            </span><span class="nt">sc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_sector&#39;</span>
<span class="w">            </span><span class="nt">st</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_station&#39;</span>
<span class="w">            </span><span class="nt">sl</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_superLayer&#39;</span>
<span class="w">            </span><span class="nt">w</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_wire&#39;</span>
<span class="w">            </span><span class="nt">l</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_layer&#39;</span>
<span class="w">            </span><span class="nt">time</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;digi_time&#39;</span>
<span class="w">        </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">            </span><span class="nt">BX</span><span class="p">:</span>
<span class="w">                </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;time</span><span class="nv"> </span><span class="s">//</span><span class="nv"> </span><span class="s">25</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">time</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">None</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">None&#39;</span>
<span class="w">        </span><span class="nt">sorter</span><span class="p">:</span>
<span class="w">            </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;p.BX&#39;</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Event</span></code> class creates <strong>n</strong> instances of the <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class, where <strong>n</strong> is determined by the <code class="docutils literal notranslate"><span class="pre">amount</span></code> key.
Attributes are defined using the <code class="docutils literal notranslate"><span class="pre">branches</span></code> map, which maps directly from TTree branches, and the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> map,
which allows for computed values using expressions (<code class="docutils literal notranslate"><span class="pre">expr</span></code>) or callable methods (specified via <code class="docutils literal notranslate"><span class="pre">src</span></code> key).
The callable methods must accept the particle instance as an argument, and the expression can access directly to the particle
instance attribute to any computation.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">particle_types</span></code> map can manage also the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>: Specifies the class path to be used for the particle. If not specified, it defaults to the <code class="docutils literal notranslate"><span class="pre">Particle</span></code> class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter</span></code>: Allows to filter particles based on boolean conditions. These conditions can use the particle instance (referred to as <code class="docutils literal notranslate"><span class="pre">p</span></code>) and the root event entry (referred to as <code class="docutils literal notranslate"><span class="pre">ev</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sorter</span></code>: Sorts particles using Python’s <code class="docutils literal notranslate"><span class="pre">sorted()</span></code>. The <code class="docutils literal notranslate"><span class="pre">by</span></code> key specifies the sorting expression (which can also use <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">ev</span></code>), and <code class="docutils literal notranslate"><span class="pre">reverse</span></code> key (default: <code class="docutils literal notranslate"><span class="pre">False</span></code>) can reverse the order.</p></li>
</ul>
<p>For example, to iterate over a TTree and create event instances with particles specified in the
<a class="reference download internal" download="" href="../../_downloads/f5460224d6fd97fc70da64df3fa38483/run_config.yaml"><code class="xref download docutils literal notranslate"><span class="pre">configuration</span> <span class="pre">file</span></code></a>, you can use the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ROOT</span><span class="w"> </span><span class="kn">import</span> <span class="n">TFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.utils.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">RUN_CONFIG</span>

<span class="c1"># update the configuration file -&gt; if it is not set, it will use the default one &#39;run_config.yaml&#39;</span>
<span class="n">RUN_CONFIG</span><span class="o">.</span><span class="n">change_config_file</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">cf_path</span><span class="p">)</span>

<span class="c1"># first, create a TFile object to read the dt ntuple (this is not necessary by using NTuple Class)</span>
<span class="k">with</span> <span class="n">TFile</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ntuple</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ntuple</span><span class="p">[</span><span class="s2">&quot;dtNtupleProducer/DTTREE;1&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">iev</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="c1"># use_config=True to use the configuration file to build the particles</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">iev</span><span class="p">,</span> <span class="n">ev</span><span class="o">=</span><span class="n">ev</span><span class="p">,</span> <span class="n">use_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Print the event summary</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">break</span> <span class="c1"># break after the first event</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ------ Event 39956 info ------
+ Index: 0
+ Digis
    * Number of digis: 81
+ Segments
    * Number of segments: 8
+ Tps
    * Number of tps: 21
+ Genmuons
    * Number of genmuons: 2
    * GenMuon 0 info --&gt;
    --&gt; Pt: 258.0812683105469, Eta: -1.9664770364761353, Phi: 0.5708979964256287, Charge: -1, Matched_segments_stations: [], Showered: False
    * GenMuon 1 info --&gt;
    --&gt; Pt: 190.72511291503906, Eta: -0.2504693865776062, Phi: -2.558511257171631, Charge: 1, Matched_segments_stations: [], Showered: False
+ Emushowers
    * Number of emushowers: 0
+ Simhits
    * Number of simhits: 50
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Event</span></code> class is highly flexible and not restricted to TTree data. As demonstrated above, you can
define any type of attributes mapping in the configuration file or even create an empty event instance and then add attributes manually as needed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># initialize an empty event with index 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<span class="c1"># It is possible to manually add particles or other attributes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Particle</span>

<span class="n">showers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Particle</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">wh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">st</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Shower&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span> <span class="c1"># create 5 showers</span>
<span class="n">event</span><span class="o">.</span><span class="n">showers</span> <span class="o">=</span> <span class="n">showers</span> <span class="c1"># add them to the event</span>

<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">showers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ------ Event 1 info ------
+ Index: 1
&gt;&gt; ------ Event 1 info ------
+ Index: 1
+ Showers
    * Number of showers: 5
&gt;&gt; Shower 4 info --&gt;
+ Wh: 1, Sc: 1, St: 1
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="particle.html" class="btn btn-neutral float-left" title="Particle" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ntuple.html" class="btn btn-neutral float-right" title="NTuple" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Daniel Estrada, Universidad de Oviedo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>